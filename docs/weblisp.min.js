"use strict";var weblisp=(()=>{var w=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var A=(f,t)=>{for(var a in t)w(f,a,{get:t[a],enumerable:!0})},L=(f,t,a,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of R(t))!v.call(f,e)&&e!==a&&w(f,e,{get:()=>t[e],enumerable:!(s=y(t,e))||s.enumerable});return f};var O=f=>L(w({},"__esModule",{value:!0}),f);var C={};A(C,{DebugInfo:()=>T,RunError:()=>u,WebLISP:()=>b});var g=class{constructor(t){this.src="";this.len=0;this.pos=0;this.token="";this.tokenRow=0;this.tokenCol=0;this.row=1;this.col=1;this.eof=!1;this.src=t,this.len=t.length,this.next()}getToken(){return this.token}getRow(){return this.tokenRow}getCol(){return this.tokenCol}isEof(){return this.eof}next(){let t=!1,a=!1;for(;;){if(a=!1,this.pos>=this.len){this.eof=!0;return}let s=this.src[this.pos];switch(s){case" ":case"	":this.pos++,this.col+=s=="	"?4:1;break;case`
`:this.pos++,this.row++,this.col=1,t&&(t=!1);break;case";":this.pos++,this.col++,t=!0;break;default:t?(this.pos++,this.col++):a=!0}if(a)break}for(this.tokenCol=this.col,this.tokenRow=this.row,this.token="";;){if(this.pos>=this.len){this.token.length==0&&(this.eof=!0);return}let s=this.src[this.pos];if(s==" "||s=="	"||s==`
`||s==";")return;if(s=="("||s==")"||s=="'"){if(this.token!=="#"&&this.token.length>0)return;this.pos++,this.col++,this.token+=s;return}this.pos++,this.col++,this.token+=s.toUpperCase()}}};function S(f,t){for(;t!=0;){let a=t;t=f%t,f=a}return f}var d=class{constructor(t,a){this.numerator=t,this.denominator=a,this.reduce()}clone(){return new d(this.numerator,this.denominator)}reduce(){let t=S(this.numerator,this.denominator);this.numerator/=t,this.denominator/=t}compare(t){let a=this.clone();a.reduce();let s=t.clone();return s.reduce(),a.numerator==s.numerator&&a.denominator==s.denominator}static fromNumber(t){return new d(t,1)}static add(t,a){let s=new d(t.numerator*a.denominator+a.numerator*t.denominator,t.denominator*a.denominator);return s.reduce(),s}static sub(t,a){let s=new d(t.numerator*a.denominator-a.numerator*t.denominator,t.denominator*a.denominator);return s.reduce(),s}static mul(t,a){let s=new d(t.numerator*a.numerator,t.denominator*a.denominator);return s.reduce(),s}static div(t,a){let s=new d(t.numerator*a.denominator,t.denominator*a.numerator);return s.reduce(),s}toFloat(){return this.numerator/this.denominator}toString(){return""+this.numerator+"/"+this.denominator}};var r=class{constructor(t,a=-1,s=-1){this.car=null;this.cdr=null;this.srcRow=-1;this.srcCol=-1;this.type=t,this.srcRow=a,this.srcCol=s}set(t){this.type=t.type,this.data=t.data,this.car=t.car,this.cdr=t.cdr,this.srcRow=t.srcRow,this.srcCol=t.srcCol}static cons(t,a,s=-1,e=-1){let n=new r("CONS",s,e);return n.car=t,n.cdr=a,n}static defun(t,a,s=-1,e=-1){let n=new r("DEFUN",s,e);return n.car=r.atomID(t),n.cdr=a,n}static global(t,a=-1,s=-1){let e=new r("GLOBAL",a,s);return e.data=t,e}static atomNIL(t=-1,a=-1){return new r("NIL",t,a)}static atomINT(t,a=-1,s=-1){let e=new r("INT",a,s);return e.data=t,e}static atomRATIO(t,a,s=-1,e=-1){let n=new r("RATIO",s,e);return n.data=new d(t,a),n}static atomFLOAT(t,a=-1,s=-1){let e=new r("FLOAT",a,s);return e.data=t,e}static atomID(t,a=-1,s=-1){let e=new r("ID",a,s);return e.data=t,e}static atomSTRING(t,a=-1,s=-1){let e=new r("STR",a,s);return e.data=t,e}static atomT(t=-1,a=-1){return new r("T",t,a)}static len(t){let a=0;for(;t.type!=="NIL";)t=t.cdr,a++;return a}static nthcdr(t,a){let s=0;for(;t.type!=="NIL";){if(s==a)return t;t=t.cdr,s++}return r.atomNIL()}static nth(t,a){let s=0;for(;t.type!=="NIL";){if(s==a)return t.car;t=t.cdr,s++}return r.atomNIL()}static deepNth(t,a){let s=r.atomNIL();for(let e=0;e<a.length&&t.type!=="NIL";e++)s=t=r.nth(t,a[e]);return s}static equalp(t,a){if(t.type!==a.type)return!1;switch(t.type){case"CONS":if(r.equalp(t.car,a.car)==!1||r.equalp(t.cdr,a.cdr)==!1)return!1;break;case"INT":if(t.data!==a.data)return!1;break;case"FLOAT":let s=t.data,e=a.data;if(Math.abs(s-e)>1e-12)return!1;break;case"RATIO":if(t.data.compare(a.data)==!1)return!1;break;case"ID":case"STR":if(t.data!==a.data)return!1;break}return!0}remove(t){let a,s;a=r.atomNIL();let e=this,n=0;for(;e.type!=="NIL";){let c=e.car;c.type!=="CONS"&&c.type===t.type&&c.data===t.data||(n==0?a=s=r.cons(c,r.atomNIL()):(s.cdr=r.cons(c,r.atomNIL()),s=s.cdr)),e=e.cdr,n++}return a}static subst(t,a,s){return a.type==="CONS"?s:a.type===s.type&&a.data===s.data?t:s.type==="CONS"?r.cons(r.subst(t,a,s.car),r.subst(t,a,s.cdr)):s}toFloat(){switch(this.type){case"INT":case"FLOAT":return this.data;case"RATIO":return this.data.toFloat();default:return 0}}toString(){switch(this.type){case"NIL":return"NIL";case"T":return"T";case"INT":return""+this.data;case"FLOAT":return""+this.data;case"RATIO":return""+this.data.toString();case"ID":case"STR":case"GLOBAL":return this.data;case"DEFUN":return"FUNCTION "+this.car.data;case"CONS":let t="(",a=this,s=0;do{if(a.type==="NIL")break;if(s>0&&(t+=" "),a.type!="CONS"){t+=". "+a.toString();break}t+=a.car.toString(),a=a.cdr,s++}while(a!=null);return t+=")",t;default:throw new Error("unimplemented")}}};var N=class{static parse(t){let a=[];for(;!t.isEof();)a.push(this.parseRec(t));return a}static parseRec(t){if(t.getToken()==="T"){let a=r.atomT(t.getRow(),t.getCol());return t.next(),a}else if(t.getToken()==="NIL"){let a=r.atomNIL(t.getRow(),t.getCol());return t.next(),a}else if(t.getToken()==="#'"){t.next();let a=this.parseRec(t);return r.cons(r.atomID("FUNCTION"),r.cons(a,r.atomNIL()),t.getRow(),t.getCol())}else if(t.getToken()==="'"){t.next();let a=this.parseRec(t);return r.cons(r.atomID("QUOTE"),r.cons(a,r.atomNIL()),t.getRow(),t.getCol())}else if(t.getToken()==="("){t.next();let a=null,s=r.atomNIL(t.getRow(),t.getCol()),e=0,n=!1,c=0;for(;!t.isEof()&&t.getToken()!==")";){let i=this.parseRec(t);if(i.type==="ID"&&i.data==="."){if(e==0)throw new p("'.' is not allowed here.",i.srcRow,i.srcCol);n=!0,c++;continue}if(n){a.cdr=i,n=!1;break}let o=r.cons(i,r.atomNIL(),i.srcRow,i.srcCol);e==0&&(s=o),a!=null&&(a.cdr=o),a=o,e++}if(n||c>1)throw new p("'.' is not allowed here.",t.getRow(),t.getCol());if(t.getToken()===")")t.next();else throw new p("expected ')'",t.getRow(),t.getCol());return s}else if(t.getToken()==="."){let a=r.atomID(".",t.getRow(),t.getCol());return t.next(),a}else if(t.getToken()[0]>="0"&&t.getToken()[0]<="9"||t.getToken().length>1&&t.getToken()[0]=="-"){let a=t.getToken(),s;return a.includes(".")?s=r.atomFLOAT(parseFloat(a),t.getRow(),t.getCol()):a.includes("/")?s=r.atomRATIO(parseInt(a.split("/")[0]),parseInt(a.split("/")[1]),t.getRow(),t.getCol()):s=r.atomINT(parseInt(a),t.getRow(),t.getCol()),t.next(),s}else{let a=t.getToken(),s=r.atomID(a,t.getRow(),t.getCol());return t.next(),s}}},p=class extends Error{constructor(t,a=-1,s=-1){a<0?super("Error: "+t):super("Error:"+a+":"+s+": "+t),this.name="ParseError"}};var T=class{constructor(){this.breakpointLine=0;this.col=0;this.variableValues={}}},b=class{constructor(){this.output="";this.program=[];this.functions={};this.variables=[{}];this.constants=new Set;this.startTime=0;this.maxSeconds=1/0;this.breakpoints=new Set;this.debugInfo=[];this.check=!0}import(t){let a=new g(t);this.program=N.parse(a)}getOutput(){return this.output}getDebugInfo(){return this.debugInfo}addBreakpoint(t){this.breakpoints.add(t)}run(t=!0,a=1/0){this.output="",this.debugInfo=[],t&&(this.functions={},this.variables=[{}],this.constants=new Set),this.startTime=Date.now(),this.maxSeconds=a;let s=[];for(let e of this.program)s.push(this.eval(e));return s}eval(t,a=!1){if(this.breakpoints.size>0&&this.breakpoints.has(t.srcRow)){let e=new T;this.debugInfo.length>0&&this.debugInfo[this.debugInfo.length-1].breakpointLine==t.srcRow&&this.debugInfo[this.debugInfo.length-1].col!=t.srcCol&&this.debugInfo.pop(),this.debugInfo.push(e),e.breakpointLine=t.srcRow,e.col=t.srcCol;let n=this.variables.length;for(let c=n-1;c>=0;c--)for(let i in this.variables[c]){let o=this.variables[c][i].toString();i in e.variableValues||(e.variableValues[i]=o)}}if(this.maxSeconds!=1/0&&(Date.now()-this.startTime)/1e3>this.maxSeconds)throw new u("max allowed runtime exceeded!");let s="";switch(t.type){case"NIL":case"T":case"INT":case"RATIO":case"FLOAT":return t;case"ID":{let e=t.data,n=this.variables.length;for(let c=n-1;c>=0;c--)if(e in this.variables[c])return this.variables[c][e];if(a)return this.variables[n-1][e]=r.atomNIL(),this.variables[n-1][e];throw new u("unknown symbol "+e)}case"CONS":switch(t.car.type){case"INT":case"RATIO":case"FLOAT":case"STR":throw new u(""+t.car.data+" is not a function name");case"CONS":{let e=this.eval(t.car);if(this.check&&e.type!=="DEFUN")throw new u("not a function");let n=e.cdr.car,c=t.cdr,i=e.cdr.cdr;return this.call(n,c,i)}case"ID":switch(s=t.car.data,s){case"+":case"*":{let e=r.atomINT(s==="+"?0:1);for(let n=t.cdr,c=0;n.type==="CONS";n=n.cdr,c++){let i=this.eval(n.car);if(e.type==="INT"&&i.type==="INT")s==="+"?e.data+=i.data:e.data*=i.data;else if(e.type==="INT"&&i.type==="RATIO"){let o=d.fromNumber(e.data),h=i.data;e.data=s==="+"?d.add(o,h):d.mul(o,h),e.type="RATIO"}else if(e.type==="RATIO"&&i.type==="INT"){let o=e.data,h=d.fromNumber(i.data);e.data=s==="+"?d.add(o,h):d.mul(o,h),e.type="RATIO"}else if(e.type==="RATIO"&&i.type==="RATIO"){let o=e.data,h=i.data;e.data=s==="+"?d.add(o,h):d.mul(o,h),e.type="RATIO"}else if(["INT","RATIO","FLOAT"].includes(e.type)&&["INT","RATIO","FLOAT"].includes(i.type)){let o=e.type==="RATIO"?e.data.toFloat():e.data,h=i.type==="RATIO"?i.data.toFloat():i.data;e.data=s==="+"?o+h:o*h,e.type="FLOAT"}else throw new u("incompatible types "+e.type+" and "+i.type+" for op "+s)}return e.type==="RATIO"&&e.data.denominator==1&&(e.data=e.data.numerator,e.type="INT"),e}case"-":case"/":{let e=r.atomINT(s==="-"?0:1);for(let n=t.cdr,c=0;n.type==="CONS";n=n.cdr,c++){let i=this.eval(n.car);if(c==0&&n.cdr.type!=="NIL")e.type=i.type,e.data=i.data;else if(e.type==="INT"&&i.type==="INT")if(s==="-")e.data-=i.data;else{let o=e.data,h=i.data;e.data=new d(o,h),e.type="RATIO"}else if(e.type==="INT"&&i.type==="RATIO"){let o;o=d.fromNumber(e.data);let h=i.data;e.data=s==="-"?d.sub(o,h):d.div(o,h),e.type="RATIO"}else if(e.type==="RATIO"&&i.type==="INT"){let o=e.data,h=d.fromNumber(i.data);e.data=s==="-"?d.sub(o,h):d.div(o,h),e.type="RATIO"}else if(e.type==="RATIO"&&i.type==="RATIO"){let o=e.data,h=i.data;e.data=s==="-"?d.sub(o,h):d.div(o,h),e.type="RATIO"}else if(["INT","RATIO","FLOAT"].includes(e.type)&&["INT","RATIO","FLOAT"].includes(i.type)){let o=e.type==="RATIO"?e.data.toFloat():i.data,h=i.type==="RATIO"?i.data.toFloat():i.data;e.data=s==="-"?o-h:o/h,e.type="FLOAT"}else throw new u("incompatible types "+e.type+" and "+i.type+" for op "+s)}return e.type==="RATIO"&&e.data.denominator==1&&(e.data=e.data.numerator,e.type="INT"),e}case">":case">=":case"<":case"<=":{let e=!0,n=s===">"||s===">="?1/0:-1/0,c;for(let i=t.cdr,o=0;i.type=="CONS";i=i.cdr,o++){let h=this.eval(i.car);switch(h.type){case"INT":let l=h.data;if(s===">"&&l>=n||s===">="&&l>n||s==="<"&&l<=n||s==="<="&&l<n){e=!1;break}else n=l;break;default:throw new u(h.toString()+" is not a number")}}if(c==0)throw new u("too few args");return e?r.atomT():r.atomNIL()}case"AND":{let e=r.atomT();for(let n=t.cdr;n.type==="CONS";n=n.cdr){let c=this.eval(n.car);if(c.type==="NIL")return c;e=c}return e}case"APPLY":{this.check&&this.checkMinArgCount(t,2);let e=this.eval(t.cdr.car);if(this.check&&e.type!=="DEFUN")throw new u("expected a function");let n=e.cdr.car,c=this.eval(t.cdr.cdr.car),i=e.cdr.cdr;return this.call(n,c,i)}case"ATOM":return this.check&&this.checkArgCount(t,1),this.eval(t.cdr.car).type!=="CONS"?r.atomT():r.atomNIL();case"CAR":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);if(this.check&&e.type!=="CONS")throw new u(s+" expects a list");return e.car}case"CDR":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);if(this.check&&e.type!=="CONS")throw new u(s+" expects a list");return e.cdr}case"CONS":return this.check&&this.checkArgCount(t,2),r.cons(this.eval(t.cdr.car),this.eval(t.cdr.cdr.car));case"CONSP":return this.check&&this.checkArgCount(t,1),this.eval(t.cdr.car).type==="CONS"?r.atomT():r.atomNIL();case"COS":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return this.check&&this.checkIsNumber(e),r.atomFLOAT(Math.cos(e.toFloat()))}case"DEFCONSTANT":{this.check&&this.checkArgCount(t,2);let e=t.cdr.car,n=this.eval(t.cdr.cdr.car);if(this.check&&e.type!=="ID")throw new u("expected ID");let c=e.data;return this.variables[0][c]=n,this.constants.add(c),r.global(c)}case"DEFPARAMETER":{this.check&&this.checkArgCount(t,2);let e=t.cdr.car,n=this.eval(t.cdr.cdr.car);if(this.check&&e.type!=="ID")throw new u("expected ID");let c=e.data;return this.variables[0][c]=n,r.global(c)}case"DEFUN":{if(this.check&&(this.checkMinArgCount(t,2),r.nth(t,1).type!=="ID"||r.nth(t,2).type!=="CONS"))throw new u("DEFUN is not well structured");let e=r.nth(t,1).data,n=r.nthcdr(t,2);return this.functions[e]=n,r.defun(e,n)}case"DO":{let e=r.atomNIL(),n={};this.variables.push(n);let c=r.nth(t,1),i=r.nth(t,2),o=r.nthcdr(t,3);if(this.check&&(c.type!=="CONS"||i.type!=="CONS"))throw new u("DO is not well structured");for(let h=c;h.type!=="NIL";h=h.cdr){let l=r.nth(h.car,0);if(this.check&&l.type!=="ID")throw new u("expected ID");let m=this.eval(r.nth(h.car,1));n[l.data]=m}for(;;){let h=!1;for(let l=0,m=i;m.type!=="NIL";l++,m=m.cdr){let I=this.eval(m.car);if(l==0)if(I.type==="T")h=!0;else break;l>0&&(e=I)}if(h)break;for(let l=o;l.type!=="NIL";l=l.cdr)this.eval(l.car);for(let l=c;l.type!=="NIL";l=l.cdr){let m=r.nth(l.car,0),I=this.eval(r.nth(l.car,2));n[m.data]=I}}return this.variables.pop(),e}case"DOLIST":{let e=r.atomNIL(),n={};this.variables.push(n);let c=r.deepNth(t,[1,0]);if(this.check&&c.type!=="ID")throw new u("expected ID");let i=this.eval(r.deepNth(t,[1,1])),o=r.nthcdr(t,2);for(;i.type!=="NIL";){n[c.data]=i.car;for(let h=o;h.type!=="NIL";h=h.cdr)this.eval(h.car);i=i.cdr}return this.variables.pop(),e}case"EQUALP":return this.check&&this.checkArgCount(t,2),r.equalp(this.eval(t.cdr.car),this.eval(t.cdr.cdr.car))?r.atomT():r.atomNIL();case"FUNCALL":{this.check&&this.checkMinArgCount(t,2);let e=this.eval(t.cdr.car);if(this.check&&e.type!=="DEFUN")throw new u("expected a function");let n=e.cdr.car,c=t.cdr.cdr,i=e.cdr.cdr;return this.call(n,c,i)}case"FUNCTION":{this.check&&this.checkArgCount(t,1);let e=t.cdr.car;if(this.check&&e.type!=="ID")throw new u("expected ID");let n=e.data;if(this.check&&!(n in this.functions))throw new u("undefined function "+n);return r.defun(n,this.functions[n])}case"IF":return this.checkMinArgCount(t,2),this.eval(r.nth(t,1)).type!=="NIL"?this.eval(r.nth(t,2)):this.eval(r.nth(t,3));case"LAMBDA":return r.defun("LAMBDA",r.nthcdr(t,1));case"LENGTH":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car),n;for(n=0;e.type==="CONS";n++)e=e.cdr;return r.atomINT(n)}case"LET":{let e=r.atomNIL(),n={};this.variables.push(n);let c=r.nth(t,1),i=r.nthcdr(t,2);for(let o=c;o.type!=="NIL";o=o.cdr){if(this.check&&r.len(o.car)!=2)throw new u("expected (id init)");let h=r.nth(o.car,0);if(this.check&&h.type!=="ID")throw new u("expected ID");let l=this.eval(r.nth(o.car,1));n[h.data]=l}for(let o=i;o.type!=="NIL";o=o.cdr)e=this.eval(o.car);return this.variables.pop(),e}case"LIST":{let e,n;e=n=r.atomNIL();for(let c=t.cdr,i=0;c.type==="CONS";c=c.cdr,i++){let o=this.eval(c.car),h=r.cons(o,r.atomNIL());i==0?e=n=h:(n.cdr=h,n=n.cdr)}return e}case"LISTP":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return e.type==="CONS"||e.type==="NIL"?r.atomT():r.atomNIL()}case"MEMBER":{this.check&&this.checkArgCount(t,2);let e=this.eval(r.nth(t,1)),n=this.eval(r.nth(t,2)),c=r.atomNIL();for(let i=n;i.type!=="NIL";i=i.cdr)r.equalp(e,i.car)&&(c=i);return c}case"NOT":return this.check&&this.checkArgCount(t,1),this.eval(t.cdr.car).type==="NIL"?r.atomT():r.atomNIL();case"NTH":{this.check&&this.checkArgCount(t,2);let e=t.cdr.car,n=this.eval(t.cdr.cdr.car);if(this.check&&e.type!=="INT")throw new u("expected an integer index");let c=e.data;if(this.check&&c<0)throw new u("expected a non-negative integer index");return r.nth(n,c)}case"NTHCDR":{this.check&&this.checkArgCount(t,2);let e=t.cdr.car,n=this.eval(t.cdr.cdr.car);if(this.check&&e.type!=="INT")throw new u("expected an integer index");let c=e.data;if(this.check&&c<0)throw new u("expected a non-negative integer index");return r.nthcdr(n,c)}case"NULL":return this.check&&this.checkArgCount(t,1),this.eval(t.cdr.car).type==="NIL"?r.atomT():r.atomNIL();case"NUMBERP":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return e.type==="INT"||e.type==="FLOAT"||e.type==="RATIO"?r.atomT():r.atomNIL()}case"OR":{let e=r.atomNIL();for(let n=t.cdr;n.type==="CONS";n=n.cdr){let c=this.eval(n.car);if(c.type!=="NIL")return c;e=c}return e}case"PROGN":{let e=r.atomNIL();for(let n=t.cdr;n.type==="CONS";n=n.cdr)e=this.eval(n.car);return e}case"QUOTE":return this.check&&this.checkArgCount(t,1),t.cdr.car;case"REMOVE":{this.check&&this.checkArgCount(t,2);let e=t.cdr.car;return this.eval(t.cdr.cdr.car).remove(e)}case"TAN":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return this.check&&this.checkIsNumber(e),r.atomFLOAT(Math.tan(e.toFloat()))}case"THIRD":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return r.nth(e,2)}case"TYPEP":{this.check&&this.checkArgCount(t,2);let e=this.eval(t.cdr.car),n=this.eval(t.cdr.cdr.car);if(this.check&&n.type!=="ID")throw new u("expected ID as second param");let c=n.data;if(this.check&&["INTEGER","FLOAT","RATIO"].includes(c)==!1)throw new u("unexpected TYPE "+c);if(e.type==="INT"&&c==="INTEGER"||e.type==="FLOAT"&&c==="FLOAT"||e.type==="RATIO"&&c==="RATIO")return r.atomT();r.atomNIL()}case"SETF":{let e=r.len(t);this.check&&this.checkEvenArgCount(t);let n=r.atomNIL();for(let c=t.cdr;c.type!=="NIL";c=c.cdr){let i=c.car;n=this.eval(i,!0),c=c.cdr;let o=this.eval(c.car);n.set(o)}return n}case"SIN":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return this.check&&this.checkIsNumber(e),r.atomFLOAT(Math.sin(e.toFloat()))}case"SUBSTITUTE":case"SUBST":{this.check&&this.checkArgCount(t,3);let e=this.eval(r.nth(t,1)),n=this.eval(r.nth(t,2)),c=this.eval(r.nth(t,3));return r.subst(e,n,c)}case"TERPRI":return this.output+=`
`,r.atomNIL();case"WRITE":{this.check&&this.checkArgCount(t,1);let e=this.eval(t.cdr.car);return this.output+=e.toString(),console.log(e.toString()),e}default:{let e=this.functions[s];if(this.check&&e==null)throw new u("unknown function "+s);let n=e.car,c=t.cdr,i=e.cdr;return this.call(n,c,i)}}default:throw new u("not allowed")}default:throw new u("unimplemented sexpr type "+t.type)}}call(t,a,s){let e={};this.variables.push(e);let n,c;for(n=a,c=t;c.type!=="NIL";n=n.cdr,c=c.cdr){if(this.check&&n.type==="NIL")throw new u("too few arguments");let o=c.car;if(this.check&&o.type!=="ID")throw new u("parameter must be an ID");e[o.data]=this.eval(n.car)}if(this.check&&n.type!=="NIL")throw new u("too many arguments");let i=r.atomNIL();for(;s.type!=="NIL";s=s.cdr)i=this.eval(s.car);return this.variables.pop(),i}checkArgCount(t,a){if(r.len(t)!=a+1)throw new u("expected "+a+" argument"+(a>0?"s":"#"))}checkMinArgCount(t,a){if(r.len(t)<a+1)throw new u("expected "+a+"+ argument"+(a>0?"s":"#"))}checkEvenArgCount(t){if((r.len(t)-1)%2!=0)throw new u("expected an even number of arguments")}checkIsNumber(t){if(t.type!=="INT"&&t.type!=="FLOAT"&&t.type!=="RATIO")throw new u("expected a number")}},u=class extends Error{constructor(t){super("Error: "+t),this.name="RunError"}};return O(C);})();
